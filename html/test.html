<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>DICOM Frame Player</title>
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    body {
      background: #000;
      color: #fff;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      padding: 16px;
      display: flex;
      flex-direction: column;
      align-items: center;
      min-height: 100vh;
    }
    .player-container {
      width: 100%;
      max-width: 1000px;
      display: flex;
      flex-direction: column;
      gap: 16px;
    }
    video {
      width: 100%;
      background: #000;
      border-radius: 8px;
    }
    .controls {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      align-items: center;
      justify-content: center;
      padding: 12px;
      background: rgba(30, 30, 30, 0.7);
      border-radius: 8px;
    }
    button {
      padding: 10px 16px;
      font-size: 16px;
      font-weight: 600;
      border: none;
      border-radius: 6px;
      background: #1a73e8;
      color: white;
      cursor: pointer;
      transition: background 0.2s;
    }
    button:hover {
      background: #0d5bbd;
    }
    button:active {
      transform: scale(0.98);
    }
    .frame-info {
      font-size: 16px;
      font-weight: 500;
      min-width: 120px;
      text-align: center;
    }
    .instructions {
      margin-top: 8px;
      font-size: 14px;
      color: #aaa;
      text-align: center;
      line-height: 1.5;
    }
    .loading {
      color: #ffcc00;
      font-style: italic;
    }
  </style>
</head>
<body>
  <div class="player-container">
    <video id="video" controls preload="auto"></video>

    <div class="controls">
      <button id="prev">‚Üê Prev (A)</button>
      <button id="playPause">‚è∏Ô∏è Pause (Space)</button>
      <button id="next">Next ‚Üí (D)</button>
      <div class="frame-info">
        Frame: <span id="frameNum" class="loading">‚Äî</span> / <span id="totalFrames" class="loading">‚Äî</span>
      </div>
    </div>

    <div class="instructions">
      ‚Ä¢ Use ‚Üê/‚Üí or A/D for frame-by-frame navigation<br>
      ‚Ä¢ Each frame is displayed for 10 seconds (as in original DICOM sequence)<br>
      ‚Ä¢ Video is fully cached in browser for instant seek
    </div>
  </div>

  <script>
    const video = document.getElementById('video');
    const frameNumEl = document.getElementById('frameNum');
    const totalFramesEl = document.getElementById('totalFrames');
    const prevBtn = document.getElementById('prev');
    const nextBtn = document.getElementById('next');
    const playPauseBtn = document.getElementById('playPause');

    // üî¥ –£–ö–ê–ñ–ò–¢–ï –ü–†–ê–í–ò–õ–¨–ù–´–ô –ü–£–¢–¨ –ö –í–ê–®–ï–ú–£ –í–ò–î–ï–û
    video.src = '/pacs/dicom/Brogimaros--Head_Brain.mp4';

    let totalFrames = 0;
    const SECONDS_PER_FRAME = 10;

    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∫–∞–¥—Ä–∞
    function updateFrameDisplay() {
      if (totalFrames <= 0) return;
      const currentFrame = Math.min(
        Math.floor(video.currentTime / SECONDS_PER_FRAME),
        totalFrames - 1
      );
      frameNumEl.textContent = currentFrame + 1;
      frameNumEl.classList.remove('loading');
    }

    // –ü–µ—Ä–µ—Ö–æ–¥ –∫ –∫–∞–¥—Ä—É
    function goToFrame(frameIndex) {
      if (totalFrames <= 0) return;
      frameIndex = Math.max(0, Math.min(frameIndex, totalFrames - 1));
      video.currentTime = frameIndex * SECONDS_PER_FRAME;
      updateFrameDisplay();
    }

    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö
    video.addEventListener('loadedmetadata', () => {
      if (isFinite(video.duration) && video.duration > 0) {
        totalFrames = Math.floor(video.duration / SECONDS_PER_FRAME);
        totalFramesEl.textContent = totalFrames;
        totalFramesEl.classList.remove('loading');
        updateFrameDisplay();
      } else {
        const checkDuration = () => {
          if (isFinite(video.duration) && video.duration > 0) {
            totalFrames = Math.floor(video.duration / SECONDS_PER_FRAME);
            totalFramesEl.textContent = totalFrames;
            totalFramesEl.classList.remove('loading');
            updateFrameDisplay();
            video.removeEventListener('timeupdate', checkDuration);
          }
        };
        video.addEventListener('timeupdate', checkDuration);
      }
    });

    // –°–æ–±—ã—Ç–∏—è
    video.addEventListener('timeupdate', updateFrameDisplay);

    prevBtn.addEventListener('click', () => {
      const currentFrame = Math.floor(video.currentTime / SECONDS_PER_FRAME);
      goToFrame(currentFrame - 1);
    });

    nextBtn.addEventListener('click', () => {
      const currentFrame = Math.floor(video.currentTime / SECONDS_PER_FRAME);
      goToFrame(currentFrame + 1);
    });

    playPauseBtn.addEventListener('click', () => {
      if (video.paused) {
        video.play().catch(e => console.warn("Autoplay blocked:", e));
        playPauseBtn.textContent = '‚è∏Ô∏è Pause (Space)';
      } else {
        video.pause();
        playPauseBtn.textContent = '‚ñ∂Ô∏è Play (Space)';
      }
    });

    // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã
    document.addEventListener('keydown', (e) => {
      if (e.code === 'Space') {
        e.preventDefault();
        playPauseBtn.click();
      } else if (e.code === 'ArrowLeft' || e.key === 'a' || e.key === 'A') {
        e.preventDefault();
        prevBtn.click();
      } else if (e.code === 'ArrowRight' || e.key === 'd' || e.key === 'D') {
        e.preventDefault();
        nextBtn.click();
      }
    });

    // –ó–∞–ø—É—Å–∫ –∑–∞–≥—Ä—É–∑–∫–∏
    video.preload = 'auto';
    video.load();
  </script>
</body>
</html>
